<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Optimum Branchings 有向グラフ $G = (V, E)$ が与えられます．各辺には重みが与えられ，辺 $e$ の重みと辺集合の重みをそれぞれ $w(e)$, $w(E)$ で表します．\n$G$ の部分グラフ $G^{\\prime} = (V, E^{\\prime})$ のうち以下の 2 条件を満たすものを branching とよびます．\n"><title>Optimum Branchings と Edmonds のアルゴリズム</title><link rel=canonical href=https://miti-7.github.io/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/><link rel=stylesheet href=/scss/style.min.d71c2372cfafb2b91702509882c4a416b145224db25049e8a59681371b974984.css><meta property='og:title' content="Optimum Branchings と Edmonds のアルゴリズム"><meta property='og:description' content="Optimum Branchings 有向グラフ $G = (V, E)$ が与えられます．各辺には重みが与えられ，辺 $e$ の重みと辺集合の重みをそれぞれ $w(e)$, $w(E)$ で表します．\n$G$ の部分グラフ $G^{\\prime} = (V, E^{\\prime})$ のうち以下の 2 条件を満たすものを branching とよびます．\n"><meta property='og:url' content='https://miti-7.github.io/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/'><meta property='og:site_name' content='Eating Your Own Cat Food'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='グラフ'><meta property='article:published_time' content='2025-06-20T00:00:00+09:00'><meta property='article:modified_time' content='2025-06-20T00:00:00+09:00'><meta property='og:image' content='https://miti-7.github.io/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/images/branching%E3%81%AE%E4%BE%8B.png'><meta name=twitter:site content="@miti_7"><meta name=twitter:creator content="@miti_7"><meta name=twitter:title content="Optimum Branchings と Edmonds のアルゴリズム"><meta name=twitter:description content="Optimum Branchings 有向グラフ $G = (V, E)$ が与えられます．各辺には重みが与えられ，辺 $e$ の重みと辺集合の重みをそれぞれ $w(e)$, $w(E)$ で表します．\n$G$ の部分グラフ $G^{\\prime} = (V, E^{\\prime})$ のうち以下の 2 条件を満たすものを branching とよびます．\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://miti-7.github.io/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/images/branching%E3%81%AE%E4%BE%8B.png'><link rel="shortcut icon" href=/images/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-5V27L45K60"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5V27L45K60")}</script><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.7.2/css/all.css></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/images/avatar.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Eating Your Own Cat Food</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://x.com/MitI_7 target=_blank title=01_Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://github.com/MitI-7 target=_blank title=02_GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/index.xml target=_blank title=03_RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=mailto:miti_7@outlook.com target=_blank title=05_mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>ダークモード</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/><img src=/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/images/branching%E3%81%AE%E4%BE%8B_hu_17f492352286d3f0.png srcset="/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/images/branching%E3%81%AE%E4%BE%8B_hu_17f492352286d3f0.png 800w, /post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/images/branching%E3%81%AE%E4%BE%8B_hu_ee6d64fab32bf31d.png 1600w" width=800 height=572 loading=lazy alt="Featured image of post Optimum Branchings と Edmonds のアルゴリズム"></a></div><div class=article-details><header class=article-category><a href=/categories/%E7%B5%84%E5%90%88%E3%81%9B%E6%9C%80%E9%81%A9%E5%8C%96/>組合せ最適化
</a><a href=/categories/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/>アルゴリズム</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/optimum-branchings-%E3%81%A8-edmonds-%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/>Optimum Branchings と Edmonds のアルゴリズム</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025/06/20</time></div></footer></div></header><section class=article-content><h2 id=optimum-branchings>Optimum Branchings</h2><p>有向グラフ $G = (V, E)$ が与えられます．各辺には重みが与えられ，辺 $e$ の重みと辺集合の重みをそれぞれ $w(e)$, $w(E)$ で表します．<br>$G$ の部分グラフ $G^{\prime} = (V, E^{\prime})$ のうち以下の 2 条件を満たすものを branching とよびます．</p><ul><li>閉路を含まない</li><li>同じ頂点に入る辺は高々 $1$ 本</li></ul><p>すべての branching の中で $w(E^{\prime})$ が最大のものを 最適 branching（optimum branching）とよびます<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>．<br>この問題は，最小全域木問題の有向辺バージョンである最小全域有向木問題と等価の問題で，互いに線形時間で変換することができます．<br>下の図は有向グラフと対応する 最適 branching の例です．$G^{\prime}$ の各コンポーネントは有向木なので，$G^{\prime}$は有向森になります．</p><img src=images/branchingの例.png width=50%><p>以下ではいくつかの定義，補題，定理を確認したのち，最適 branching を求める Edmonds のアルゴリズムを説明します．<br>このアルゴリズムの計算量は $O(|E||V|)$ です．他にも $O(|E| \log |V|)$ の Tarjan の実装や $O(|E| + |V| \log |V|)$ の Gabow のアルゴリズムなどがあります．<br>また，最小重み有向木問題などのバリエーションを最適 Branching に帰着する方法と説明します．<br>最後に実装例として<a class=link href="https://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=GRL_2_B" target=_blank rel=noopener>AOJ - 最小全域有向木</a>の提出コードへのリンクをはっておきます．</p><h2 id=定義>定義</h2><h3 id=critical>critical</h3><p>辺 $e = (u, v)$ が以下の 2 条件を満たすとき critical という．</p><ul><li>$w(e) \gt 0$</li><li>$v$ に接続するすべての辺 $e^{\prime}$ に対して，$w(e) \ge w(e^{\prime})$</li></ul><p>$G$ の全域部分グラフ $H$ が以下の条件を満たすとき critical subgraph という．特にそれ以上辺を追加できない critical subgraph を maximal critical subgraph という．</p><ul><li>$H$ のすべての辺は critical</li><li>$H$ の各頂点の入次数は高々 $1$</li></ul><p>下の図は maximal critical subgraph の例です．critical な辺を赤線で示しています．</p><img src=images/maximal_critical_subgraph.png width=25%><h3 id=eligible>eligible</h3><p>辺 $e$ が入る頂点を $head(e)$ と表す．$G = (V, E)$ の branching $B$ に対して，$(B \backslash \lbrace (u, v) \in B : v = head(e) \rbrace) \cup \lbrace e \rbrace$ も branching になるとき，$e$ を eligible という．</p><h2 id=補題-1>補題 1</h2><p>maximal critical subgraph $H$ は以下の性質を持ちます．</p><ol><li>各コンポーネントは高々 1 つの閉路をもち，閉路は互いに素</li><li>$H$ に閉路がなければ最適 branching</li></ol><details><summary>証明</summary><hr><ol><li><p>頂点 $v$ が $2$ つの有向閉路上にあるとします．このとき，次数が少なくとも $2$ 以上の頂点が存在します．これは critical subgraph の条件に反します．</p></li><li><p>$H$ に閉路がなければ $H$は branching です．任意の branching $B$ のすべての頂点 $v$ について以下が成り立ちます．<br>$w(B \cap \lbrace e | head(e) = v \rbrace) \le w(H \cap \lbrace e | head(e) = v \rbrace)$<br>これらをすべての頂点について足し合わせると $w(B) \le w(H)$ となり，$H$ が最適となります．</p></li></ol><hr></details><h2 id=補題-2>補題 2</h2><p>辺 $e = (u, v) \in E \backslash B$ が eligible なことと，$B$ 上に $v$ から $u$ への有向パスがないことは同値</p><details><summary>証明</summary><hr><ul><li><p>「辺 $e = (u, v) \in E \backslash B$ が eligible」なら「$B$ 上に $v$ から $u$ への有向パスがない」<br>対偶として，$v$ から $u$ への有向パスがあるなら，$e$ は eligible ではないことを示します．<br>$v$ から $u$ への有向パスがあるため，$(u, v)$ を追加すると閉路が発生します．<br>これは eligible の定義に反するため，$e$ は eligible ではありません．</p></li><li><p>「$B$ 上に $v$ から $u$ への有向パスがない」なら「辺 $e = (u, v) \in E \backslash B$ が eligible」<br>$e$ を $B$ に追加したとき，$(x, head(e)) \in B$ の辺を削除すれば $v$ へ入る辺は高々 $1$ 本です．<br>また，$B$ には $v \rightarrow u$ パスがないので，$e$ を追加しても閉路は発生しません．<br>よって，$e$ は eligible です．</p></li></ul><hr></details><h2 id=補題-3>補題 3</h2><p>$B$ を $G = (V, E)$ の branching，$C$ を $G$ の有向サイクルとする．$C \backslash B$ に eligible な辺がなければ， $|C \backslash B| = 1$ となる</p><details><summary>証明</summary><p>$C \backslash B$ に eligible な辺がないとき，$|C \backslash B|$ は 1 以外にならないことを示します．</p><ul><li><p>$|C \backslash B| = 0$ にならない<br>$B$ は branching なので起こりません</p></li><li><p>$|C \backslash B| = 2$ にならない<br>$C \backslash B = \lbrace (s_1, t_1), (s_2, t_2) \rbrace$ と仮定します．<br>どちらの辺も eligible でないので，$B$ に $t_1$ から $s_1$ への有向パスと $t_2$ から $s_2$ への有向パスが存在します．<br>$C$ は閉路なので，$t_2$ から $s_1$ への有向パスと $t_1$ から $s_2$ への有向パスは $C$ 上に存在します．<br>よって，$B$ には，$t_2 \rightarrow \cdots \rightarrow \cdots s_1 \rightarrow t_1 \rightarrow \cdots \rightarrow s_2 \rightarrow t_2$ のようなパスができます．<br>これは，$B$ の中に閉路があるということになり，$B$ が branching という仮定に矛盾します．</p></li><li><p>$|C \backslash B| = k \gt 2$ にならない<br>$|C \backslash B| = 2$ に帰着します．</p></li></ul></details><h2 id=定理-1>定理 1</h2><p>$G$ の maximal critical subgraph $H$ に対し，以下の最適 branching $B$ が存在する．</p><ul><li>$H$ に含まれるすべての有向閉路 $C_i$ について，$| C_i \backslash B| = 1$．</li></ul><p>つまり，$H$ の各有向閉路からちょうど $1$ 本だけ辺が取り除かれているような最適 branching が存在するということです．<br>下の図は $G$ に対する maximul critical subgraph $H$ と最適 branching です．<br>$H$ の閉路から $(0, 1)$ と $(3, 5)$ を取り除いた最適 branching が存在することがわかります．</p><img src=images/theorem1_0.png width=50%><details><summary>証明</summary><hr><p>最適 branching のうち，$H$ の辺を最も多く含んでいるものを $B$ と仮定します．<br>補題 2 により，$C \backslash B$ に eligible な辺がなければ，$|C \backslash B| = 1$ となるので，各 $C_i \backslash B$ のすべての辺が eligible でないことを示します．<br>$e \in H \backslash B$ が eligible であると矛盾が起きることを示します．<br>$e$ は eligible なので，新しい branching $B^{\prime} = \lbrace B \backslash \lbrace e^{\prime} \rbrace \rbrace \cup \lbrace e \rbrace$ を作ることができます．ここで $e^{\prime}$ は，$head(e)$ に入る $B$ 上の辺です．<br>このとき，$e \in H$ であり，$e^{\prime} \notin H$ であるため，$B^{\prime}$ は $B$ より多くの $H$ の辺を含みます．<br>また，$e$ は critical なので，$B^{\prime}$ は最適 branching です．<br>よって，$B$ より$H$ の辺を多く含む最適 branching $B^{\prime}$ ができることとなり，これは仮定に矛盾します．</p><hr></details><h2 id=定理-2>定理 2</h2><p>定理 1 を満たすような最適 branching $B$ に，以下の条件を満たす解が存在する．ここで $e^{0}_i$ は $C_i$ で最も重みの小さい辺である．</p><ol><li>各有向閉路 $C_i$ で $|C_i \backslash B| = 1$</li><li>もし有向閉路 $C_i$ へ外部から入る辺が $B$ に存在しないなら，$C_i \backslash B = \lbrace e^{0}_i \rbrace$ である．</li></ol><details><summary>証明</summary><hr><p>1.を満たす最適 branching の中で，$\lbrace e^{0}_0, e^{1}_0, \cdots, e^{0}_k \rbrace$ が含まれる数がもっとも多いものを $B$ とします．<br>$B$ には $C_i$ に外部から入る辺が存在しないにも関わらず，$C_i$ に $e^{0}_i$ が含まれていると仮定します．<br>$C_i \backslash B = \lbrace e \rbrace$ とします．<br>$B^{\prime} = (B \backslash \lbrace e^{0}_i \rbrace) \cup \lbrace e \rbrace$ とします．<br>この $B^{\prime}$ は $\lbrace e^{0}_i \rbrace$ を含む最適 branching です．
これは仮定と矛盾します．</p><hr></details><h2 id=edmonds-のアルゴリズム>Edmonds のアルゴリズム</h2><p>グラフ $G = (V, E)$ の最適 branching を求める方法を考えます．表記上の都合のため多重辺はないものとします<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>．</p><p>まず，maximal critical subgraph を求め，この辺集合を $H$ とします．<br>補題 1 により $(V, H)$ が branching なら $(V, H)$ は最適 branching です．</p><p>$(V, H)$ が branching でない場合を考えます．<br>この場合，$(V, H)$ には有向閉路が 1 つ以上存在します．<br>定理 1 により，各閉路から 1 本辺を削除した辺集合を含む最適 branching $B^{\star}$ が存在することがわかります．今後はこの $B^{\star}$ を求めていきます．</p><p>$B^{\star}$ を求めるためには maximal critical graph の各閉路のどの辺を削除すればいいのかを考ます．<br>もし，$B^{\star}$ に（閉路の）外部から閉路に入る辺 $(u, v)$ がある場合，$v$ の入次数が $2$ になるのを避けるために閉路内で $v$ に入る辺を削除することになります．反対に，外部から閉路に入る辺がない場合，定理 2 より閉路内で最小の辺を削除することになります．<br>つまり，閉路のどの辺を削除するかは閉路外部の辺構造によって決めることができます．そこで，閉路内部の辺構造（つまり，どの辺を削除するのか）を決めるより先に外部の辺構造を決めてしまいます．<br>そのために，閉路外部の重みを適切に調整した上で閉路を $1$ つの超頂点に縮約します．この手続きによって得られるグラフを $G^{\prime} = (V^{\prime}, E^{\prime})$ とします．<br>この $G^{\prime}$ の最適 branching に超頂点に入る辺があるかどうかによって，$H$ の閉路のどの辺を削除するかを決めることができます．</p><p>$G^{\prime}$ の辺の重み $w^{\prime}$ をどう設定するかを考えます．<br>$G^{\prime}$ の最適 branching から構成した $G$ の branching も最適 branching であるという条件を満たす必要があります．<br>このためには，任意の branching について，$w(B) = w^{\prime}(B^{\prime}) + const$ であることを示せればいいです．$B^{\prime}$ と $B$ の重みの差は定数なので，$B^{\prime}$ が最適なら $B$ も最適といえるためです．<br>外部から閉路に入る辺を $e = (u, v)$，$v$ に入る閉路内唯一の辺を $\tilde e$，閉路の最小の重みを持つ辺を $e^{0}$ とします．
この条件を満たすためには，閉路に入る辺 $e$ の重みを $w^{\prime}(e) = w(e) - w(\tilde e) + w(e^{0})$ と設定すればいいです．<br>閉路に入る辺以外の重みは $w$ のままとします．</p><details><summary>証明</summary><hr><p>$w(B) = w^{\prime}(B^{\prime}) + const$ となることを示します．<br>$B^{\prime}$ の超頂点を展開したときの重みの増加分を考えます．</p><ul><li><p>超頂点に入る辺 $e$ がないとき</p><ul><li>$e^{0}_i$ 以外の辺を採用するので，$w(C_i) - w(e^{0}_i)$ だけ増加します．</li></ul></li><li><p>超頂点に入る辺 $e$ があるとき</p><ul><li>$w(\tilde e)$ 以外の辺を採用するので，$w(C_i) - w(\tilde e)$ だけ増加します．<br>ただし，$e$ の重みを $w^{\prime}(e) = w(e) - w(\tilde e) + w(e^{0}_i)$ と調整していたので，この調整を打ち消すと $w(C_i) - w(\tilde e) - (- w(\tilde e) + w(e^{0}_i)) = w(C_i) - w(e^{0}_i)$ となります．<br>結局，$w(C_i) - w(e^{0}_i)$ だけ増加します．</li></ul></li></ul><p>よって，どちらも $w(C_i) - w(e_i^{0})$ だけ増加するので，すべての閉路についてこの和をとると $w(B) = w^{\prime}(B^{\prime}) + \sum_{i} w(C_i) - \sum_{i} w(e_i^{0})$ となります．<br>$\sum_{i} w(C_i) - \sum_{i} w(e^{0}_i)$ の部分は branching のとり方に依存しないため定数とみなすことができ，$w(B) = w^{\prime}(B^{\prime}) + const$ となります．</p><hr></details><p>このように重みを設定した $G^{\prime}$ に対し，最適 branching を求める手続きを再帰的に実行します．<br>$G^{\prime}$ は元のグラフより厳密に頂点数が少なくなるため，この手続きは有限回で終了します．</p><p>$G$ の最適 branching $B$ は，この再帰呼び出しから返される $G^{\prime}$ の最適 branching $B^{\prime}$ に対して，閉路の $1$ 本を除いた残りすべての辺を加えることにより構築することができます．</p><p>最後に計算量について考えます．<br>1 回の手続きで少なくとも 1 つの頂点が減ります．1 回の手続きには $O(|E|)$ かかるので，このアルゴリズムの計算量は $O(|E||V|)$ です．</p><h2 id=edmonds-のアルゴリズムまとめ>Edmonds のアルゴリズムまとめ</h2><ul><li><p>step 1: maximal critical subgraph の構築
maximal critical subgraph を求めます．この辺の集合を $H$ とします．</p></li><li><p>step 2: 閉路のチェック<br>$(V, H)$ が branching を形成する場合，$(V, H)$ が最適 branching であるため，これを返します．</p></li><li><p>step 3: 閉路の縮約<br>$H$ が $1$ つ以上の閉路を含む場合，任意の閉路 $C$ を選び，$C$ を $1$ つの超頂点 $a$​ に縮約します．<br>この操作によってできたグラフを $G^{\prime} = (V^{\prime}, E^{\prime})$とします．ここで，$V^{\prime} = (V \backslash C) \cup a$ です．</p></li><li><p>step 4: $G^{\prime}$ における辺の重みの変更</p><ul><li>$C$ に入る辺：<ul><li>辺 $(u \notin C, v \in C)$ に対して、$G^{\prime}$ 内の新しい辺 $(u, a​)$ の重み $w^{\prime}(u, a)$ を $w(u, v) - w(\tilde e) + w(e^{0})$ とします．ここで，$w(\tilde e)$ は $C$ に存在する頂点 $v$ に入る辺の重み，$w(e^{0})$ は $C$ に存在する辺の最小の重みです．</li></ul></li><li>$C$ から出る辺：<ul><li>辺 $(u \in C, v \notin C)$ に対して、$G^{\prime}$ 内の新しい辺 $(a, v)$ の重み $w^{\prime}(a​, v)$ を $w(u, v)$ とします．</li></ul></li><li>$C$ に無関係な辺：<ul><li>辺 $(u \notin C,v \notin C)$ に対して、$(u, v​)$ の重み $w^{\prime}(u, v​)$ を $w(u, v)$ とします．</li></ul></li></ul></li><li><p>step 5: 再帰呼び出し<br>$G^{\prime}$ の最適 branching を再帰的に見つけます．</p></li><li><p>step 6: 展開<br>$G^{\prime}$ の最適 branching が，閉路の外から超頂点 $a$​ に入る辺を持つ場合</p><ul><li>超頂点を展開します．$a$ に入る辺が展開後 $(u, v)$ であったとします．$C$ に含まれる辺のうち $v$ に入る辺以外の $|C| - 1$ 本を採用します．このようにして選んだ辺集合は最適 branching であるため，これを返します．</li></ul><p>$G^{\prime}$ の最適 branching が，閉路の外から超頂点 $a$​ に入る辺を持たない場合</p><ul><li>超頂点を展開します．$C$ に含まれる辺のうち，最小の重みの辺以外の $|C| - 1$本を採用します．このようにして選んだ辺集合は最適 branching であるため，これを返します．</li></ul></li></ul><h2 id=アルゴリズムの実行例>アルゴリズムの実行例</h2><p>下のグラフの branching を求めます．</p><img src=images/edmonds_0.png width=25%><hr><h3 id=phase1>phase1</h3><ul><li>maximal critical subgraph を求めます．図では赤色の辺が対応します．</li><li>閉路のチェック<ul><li>$(2, 5), (5, 4), (4, 2)$ によって閉路が生じます．</li></ul></li><li>閉路の縮約<ul><li>閉路に属する頂点 $\lbrace 2, 4, 5 \rbrace$ を超頂点 $6$ に縮約します．</li></ul></li><li>辺の重みの変更<ul><li>超頂点に入る辺 $(0, 2)$ の重みを変更します．$2$ に入る閉路の辺の重みは $5$，閉路最小の重みは $4$ なので，$2 - 5 + 4 = 1$ となります．</li><li>超頂点に入る辺 $(3, 4)$ の重みを変更します．$4$ に入る閉路の辺の重みは $4$，閉路最小の重みは $4$ なので，$3 - 4 + 4 = 3$ となります．</li></ul></li><li>再帰呼び出し<ul><li>新しくできたグラフの最適 branching を求めます．</li></ul></li></ul><img src=images/edmonds_1.png width=50%><hr><h3 id=phase2>phase2</h3><ul><li>maximal critical subgraph を求めます．</li><li>閉路のチェック<ul><li>$(1, 3), (3, 6), (6, 1)$ によって閉路が生じます．</li></ul></li><li>閉路の縮約<ul><li>閉路に属する頂点 $\lbrace 1, 3, 6 \rbrace$ を超頂点 $7$ に縮約します．</li></ul></li><li>辺の重みの変更<ul><li>超頂点に入る辺 $(0, 6)$ の重みを変更します．$6$ に入る閉路の辺の重みは $3$，閉路最小の重みは $1$ なので，$1 - 3 + 1 = -1$ となります．</li></ul></li><li>再帰呼び出し<ul><li>新しくできたグラフの最適 branching を求めます．</li></ul></li></ul><img src=images/edmonds_2.png width=50%><hr><h3 id=phase3>phase3</h3><ul><li>maximal critical subgraph を求めます．</li><li>閉路のチェック<ul><li>閉路が存在しないため，これは最適 branching です．</li></ul></li></ul><img src=images/edmonds_3.png width=25%><hr><h3 id=phase4>phase4</h3><p>ここからは閉路の展開をしていきます．<br>現在は，$(7, 0)$ が branching の辺として選ばれています．<br>branching として選ばれた辺は青色の辺で示していきます．<br><img src=images/edmonds_4.png width=25%></p><hr><h3 id=phase5>phase5</h3><p>超頂点 $7$ を展開します．超頂点 $7$ は $(1, 3), (3, 6), (6, 1)$ からなる閉路でした．<br>この閉路に入る辺はないので，閉路のなかで最小の辺 $(6, 1)$ を除外し，$(1, 3), (3, 6)$ を採用します．
<img src=images/edmonds_5.png width=50%></p><hr><h3 id=phase6>phase6</h3><p>超頂点 $6$ を展開します．超頂点 $6$ は $(2, 5), (5, 4), (4, 2)$ からなる閉路でした．<br>この閉路には $(3, 4)$ が入るので，閉路の中で $4$ に入る $(5, 4)$ を除外し，$(2, 5), (4, 2)$ を採用します．<br>すべての閉路を展開をしたので，アルゴリズムを終了します．<br><img src=images/edmonds_6.png width=50%></p><h2 id=問題のバリエーション>問題のバリエーション</h2><p>以下の問題は，optimal branching と等価の問題であり，最適 branching のアルゴリズムを使って解くことができます．</p><h3 id=最小重み有向木問題minimum-weight-arborescence-problem>最小重み有向木問題（Minimum Weight Arborescence Problem）</h3><p>$G = (V, E)$ の全域有向森ではなく，全域有向木を求める問題です．木の根は任意になります．<br>$G$ に全域有向木が存在すると仮定します．<br>$G = (V, E)$ に対し，$K = 1 + \sum_{e \in E} |w(e)|$ とします．<br>$w^{\prime}(e) = K - w(e)$ と重みを変更した $G$ で最適 branching 問題を解きます．</p><p>木 $B$ の辺の数を $|B|$ と表します．$|B| \gt |B^{\prime}|$ である任意の $2$ つの有向木 $B$，$B^{\prime}$ に対して，$w^{\prime}(B) - w^{\prime}(B^{\prime}) = (|B| - |B^{\prime}|)K - (w(B) - w(B^{\prime})) \ge 0$ が成り立ちます．<br>よって，$|B| \gt |B^{\prime}|$ ならば $w^{\prime}(B) \gt w^{\prime}(B^{\prime})$ であるため，最小重み有向木問題の解を求めることができます．</p><h3 id=最小重み根指定有向木問題minimum-weight-rooted-arborescence-problem>最小重み根指定有向木問題（Minimum Weight Rooted Arborescence Problem）<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></h3><p>最小重み有向木問題で，全域木の根 $r$ が指定されている問題です．<br>$G$ に $r$ を根とする全域有向木が存在すると仮定します．<br>超頂点 $s$ を用意し，$G^{\prime} = (V(G) \cup \lbrace s \rbrace, E \cup \lbrace (s, r) \rbrace)$，$w(s, r) = 0$ とします．<br>$G^{\prime}$ に対し，最小重み有向木問題の解を求め，$s$ を削除することで，最小重み根指定有向木問題の解を得ることができます．</p><h2 id=問題>問題</h2><ul><li><a class=link href="https://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=GRL_2_B" target=_blank rel=noopener>AOJ - 最小全域有向木</a><ul><li><a class=link href="https://judge.u-aizu.ac.jp/onlinejudge/review.jsp?rid=10616122#1" target=_blank rel=noopener>提出コード</a></li></ul></li></ul><h2 id=参考>参考</h2><ul><li><a class=link href=https://en.wikipedia.org/wiki/Edmonds%27_algorithm target=_blank rel=noopener>Edmonds&rsquo; algorithm</a></li><li><a class=link href=https://users-math.au.dk/jensen/teaching/2018GraphTheory2/notes.pdf target=_blank rel=noopener>Lecture notes: Graph Theory 2</a></li><li><a class=link href=https://faculty.fiu.edu/~ramsamuj/graphtheory/chap3.pdf target=_blank rel=noopener>GRAPH THEORY 3. Trees</a></li><li><a class=link href=https://www.taylorfrancis.com/books/mono/10.1201/b19163 target=_blank rel=noopener>Handbook of Graph Theory, Combinatorial Optimization, and Algorithms</a></li><li><a class=link href=https://www.maruzen-publishing.co.jp/book/b10121874.html target=_blank rel=noopener>組合せ最適化</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a class=link href=https://www.maruzen-publishing.co.jp/book/b10121874.html target=_blank rel=noopener>組合せ最適化</a>では最大重み有向森問題（Maximum Weight Branching Problem）と表記されています&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>重みが最小の branching を求めたいときは重みの正負を反転します&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>辺を $(u, v)$ と表記したときに，一意に定めるためです&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>最小全域有向木問題，最小有向木問題とも&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><footer class=article-footer><section class=article-tags><a href=/tags/%E3%82%B0%E3%83%A9%E3%83%95/>グラフ</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><section class="section sns_parent"><div class="container sns_section"><div class="sns_button twitter"><a href="http://x.com/intent/tweet?url=https%3a%2f%2fmiti-7.github.io%2fpost%2foptimum-branchings-%25E3%2581%25A8-edmonds-%25E3%2581%25AE%25E3%2582%25A2%25E3%2583%25AB%25E3%2582%25B4%25E3%2583%25AA%25E3%2582%25BA%25E3%2583%25A0%2f&text=Optimum%20Branchings%20%e3%81%a8%20Edmonds%20%e3%81%ae%e3%82%a2%e3%83%ab%e3%82%b4%e3%83%aa%e3%82%ba%e3%83%a0" target=_blank title=twitter><i class="fab fa-twitter"></i></a></div><div class="sns_button hatena"><a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fmiti-7.github.io%2fpost%2foptimum-branchings-%25E3%2581%25A8-edmonds-%25E3%2581%25AE%25E3%2582%25A2%25E3%2583%25AB%25E3%2582%25B4%25E3%2583%25AA%25E3%2582%25BA%25E3%2583%25A0%2f&title=Optimum%20Branchings%20%e3%81%a8%20Edmonds%20%e3%81%ae%e3%82%a2%e3%83%ab%e3%82%b4%e3%83%aa%e3%82%ba%e3%83%a0" target=_blank title=hatena><i class=hatena-icon></i></i></a></div><div class="sns_button bluesky"><a href="https://bsky.app/intent/compose?text=Optimum+Branchings+%E3%81%A8+Edmonds+%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0+https%3A%2F%2Fmiti-7.github.io%2Fpost%2Foptimum-branchings-%25E3%2581%25A8-edmonds-%25E3%2581%25AE%25E3%2582%25A2%25E3%2583%25AB%25E3%2582%25B4%25E3%2583%25AA%25E3%2582%25BA%25E3%2583%25A0%2F" target=_blank title="Share on Bluesky"><i class="fab fa-bluesky"></i></a></div></div></section><aside class=related-content--wrapper><h2 class=section-title>関連するコンテンツ</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/%E6%9C%80%E5%B0%8F%E8%B2%BB%E7%94%A8%E6%B5%81%E5%95%8F%E9%A1%8C%E3%81%AE%E6%9C%80%E7%9F%AD%E8%B7%AF%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%97%E6%B3%95/><div class=article-details><h2 class=article-title>最小費用流問題の最短路繰り返し法</h2></div></a></article><article class=has-image><a href=/post/%E6%9C%80%E5%B0%8F%E8%B2%BB%E7%94%A8%E6%B5%81%E5%95%8F%E9%A1%8C%E3%81%AE-primal-network-simplex-%E6%B3%95/><div class=article-image><img src=/post/%E6%9C%80%E5%B0%8F%E8%B2%BB%E7%94%A8%E6%B5%81%E5%95%8F%E9%A1%8C%E3%81%AE-primal-network-simplex-%E6%B3%95/images/%E3%83%9D%E3%83%86%E3%83%B3%E3%82%B7%E3%83%A3%E3%83%AB%E3%81%AE%E6%9B%B4%E6%96%B0.3bfa2bb0c3577328b35c2c662b3302c5_hu_bcebbcd08f45c62d.png width=250 height=150 loading=lazy alt="Featured image of post 最小費用流問題の Primal Network Simplex 法" data-hash="md5-O/orsMNXcyizXCxmKzMCxQ=="></div><div class=article-details><h2 class=article-title>最小費用流問題の Primal Network Simplex 法</h2></div></a></article><article><a href=/post/primal-dual-algorithm%E5%8E%B3%E5%AF%86%E8%A7%A3/><div class=article-details><h2 class=article-title>Primal Dual Algorithm(厳密解)</h2></div></a></article><article class=has-image><a href=/post/quadratic-pseudo-boolean-optimization/><div class=article-image><img src=/post/quadratic-pseudo-boolean-optimization/images/general_sample_ab_1.4998d222353165ec59581a5fa08b102f_hu_7879d51069c68570.png width=250 height=150 loading=lazy alt="Featured image of post Quadratic Pseudo-Boolean Optimization" data-hash="md5-SZjSIjUxZexZWBpfoIsQLw=="></div><div class=article-details><h2 class=article-title>Quadratic Pseudo-Boolean Optimization</h2></div></a></article><article><a href=/post/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%95%8F%E9%A1%8C%E3%81%AE%E6%9C%80%E9%81%A9%E6%80%A7%E6%9D%A1%E4%BB%B6%E3%81%A8-reduced-arc-length/><div class=article-details><h2 class=article-title>最短路問題の最適性条件と reduced arc length</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=MitI-7/MitI-7.github.io data-repo-id=R_kgDOMu10ww data-category=Announcements data-category-id=DIC_kwDOMu10w84Cltew data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 Eating Your Own Cat Food</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> で構築されています。<br>テーマ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> は <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> によって設計されています。</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>